<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Escape the Grid â€” Professional Build</title>
  <style>
    :root{
      --bg1:#071026; --bg2:#061226; --card:#071426; --accent:#06b6d4; --accent-2:#7c3aed; --muted:#9fb0c8; --glass: rgba(255,255,255,0.03);
      --success:#10b981; --danger:#ef4444; --radius:14px; --gap:10px; --cell-size:56px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1) 0%, #021226 100%);color:#e6f2fb;-webkit-font-smoothing:antialiased}

    .wrap{max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:1fr 360px;gap:20px}

    header{grid-column:1/-1;display:flex;gap:16px;align-items:center}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#0ea5a4);display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 8px 30px rgba(6,182,212,0.12)}
    .brand h1{margin:0;font-size:18px}
    .brand p{margin:0;color:var(--muted);font-size:13px}

    .top-actions{margin-left:auto;display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;cursor:pointer;color:inherit}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#021026;font-weight:700}

    /* board card */
    .board-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:var(--radius);box-shadow:0 10px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .meta .left{display:flex;gap:12px;align-items:center}
    .pill{background:var(--glass);padding:6px 10px;border-radius:999px;font-size:13px}

    /* grid */
    #board{display:grid;gap:8px;justify-content:center;align-items:center;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));}
    .cell{width:var(--cell-size);height:var(--cell-size);display:flex;align-items:center;justify-content:center;border-radius:10px;font-weight:700;user-select:none;transition:transform .12s ease, box-shadow .12s ease}
    .cell.tile{background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.008));border:1px solid rgba(255,255,255,0.03);color:#bfe8f3}
    .cell.wall{background:linear-gradient(180deg,#031226,#041626);border:1px dashed rgba(255,255,255,0.02);opacity:0.85}
    .cell.start{background:linear-gradient(90deg,#065f46,#10b981);color:#021226}
    .cell.exit{background:linear-gradient(90deg,#1e40af,#60a5fa);color:#021226}
    .cell.clue{background:linear-gradient(90deg,#f59e0b,#f97316)}
    .cell.trap{background:linear-gradient(90deg,#ef4444,#f43f5e)}
    .cell.puzzle{background:linear-gradient(90deg,#8b5cf6,#7c3aed)}
    .cell.player{box-shadow:0 12px 30px rgba(96,165,250,0.15);transform:translateY(-4px);}
    .cell.fade{opacity:0.35}

    /* right panel */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .panel h3{margin:0 0 8px 0}
    .muted{color:var(--muted);font-size:13px}

    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}

    .big{font-size:20px;font-weight:800}
    .small{font-size:12px}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(2,6,23,0.7), rgba(2,6,23,0.7));}
    .modal.open{display:flex}
    .modal .box{width:min(720px,96%);background:linear-gradient(180deg,#06122a,#021226);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

    /* tutorial */
    .help{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);margin-top:10px}

    footer{grid-column:1/-1;text-align:center;color:var(--muted);margin-top:12px}

    @media (max-width:1100px){.wrap{grid-template-columns:1fr}} 
    @media (max-width:560px){:root{--cell-size:44px} .brand p{display:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">EG</div>
        <div>
          <h1>Escape the Grid</h1>
          <p>Polished puzzle-adventure â€” responsive, accessible, and interactive</p>
        </div>
      </div>

      <div class="top-actions">
        <button id="restartAll" class="btn">Reset All</button>
        <button id="tutorialBtn" class="btn">Tutorial</button>
        <button id="exportBtn" class="btn">Export Save</button>
        <button id="openEditor" class="btn">Level Editor</button>
      </div>
    </header>

    <section class="board-card">
      <div class="meta">
        <div class="left">
          <div class="pill" id="levelTitle">Level 1 â€” Intro</div>
          <div class="muted"> <span id="stageInfo">6 Ã— 6</span></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="muted small">Time</div><div class="pill" id="timer">--:--</div>
          <div class="muted small">Moves</div><div class="pill" id="moves">0</div>
          <button id="hintBtn" class="btn">Hint (<span id="hints">3</span>)</button>
        </div>
      </div>

      <div id="board" aria-label="Game board"></div>

      <div style="display:flex;justify-content:center;margin-top:12px;gap:8px">
        <button class="btn" id="up">â–²</button>
        <button class="btn" id="left">â—€</button>
        <button class="btn" id="down">â–¼</button>
        <button class="btn" id="right">â–¶</button>
        <button class="btn primary" id="replay">Restart Level</button>
      </div>

      <div class="help">
        <strong>How to play</strong>
        <p class="muted">Use arrow keys or WASD. Click adjacent tiles to move. Complete puzzles and avoid traps. Use hints sparingly â€” progress is saved automatically.</p>
      </div>
    </section>

    <aside class="panel">
      <h3>Level Manager</h3>
      <div class="muted">Choose levels, view progress, and customize maps.</div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" id="prevLevel">Prev</button>
        <button class="btn" id="nextLevel">Next</button>
        <button class="btn" id="unlockBtn">Unlock GTU</button>
      </div>

      <div style="margin-top:14px">
        <div class="muted">Progress</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div>Current Level</div><div class="big" id="currentLevel">1</div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div>Completed</div><div id="completedList" class="muted">â€”</div>
        </div>
      </div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">
      <h3>Level Editor</h3>
      <textarea id="levelJson" style="width:100%;height:160px;background:#041226;color:#dff3ff;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="loadJson">Load JSON</button>
        <button class="btn" id="saveJson">Download Levels</button>
      </div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">
      <div class="muted">High-contrast mode, accessibility-friendly UI, and keyboard-first controls were prioritized.</div>
    </aside>

    <div id="modal" class="modal" role="dialog" aria-modal="true">
      <div class="box">
        <div id="modalContent"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px">
          <button id="closeModal" class="btn">Close</button>
        </div>
      </div>
    </div>

    <footer>Professional version â€” polished visuals, clearer UX, improved responsiveness. Want music, animations, or a React port? Tell me which.</footer>
  </div>

  <script>
    // ---------------- Utilities ----------------
    const $ = s => document.querySelector(s);
    const q = (s) => Array.from(document.querySelectorAll(s));

    // Audio feedback
    let audioCtx = null;
    function initAudio(){ if(audioCtx) return; audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function sfx(freq=440,dur=0.06,vol=0.06){ try{ initAudio(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination); o.start(); setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.02); o.stop(audioCtx.currentTime+0.03); }, dur*1000); }catch(e){/*ignore*/} }

    // ---------------- Storage & Data ----------------
    const KEY = 'escape-grid:save:v2';
    const KEY_LEVELS = 'escape-grid:levels:v2';

    const DEFAULT_LEVELS = [
      { id:1, title:'Intro', rows:6, cols:6, map:[['S',0,0,0,0,0],[0,1,1,0,'P',0],[0,0,0,1,0,0],[0,'C',0,0,1,0],[0,1,0,0,0,'T'],[0,0,0,0,0,'E']], timer:120 },
      { id:2, title:'Gauntlet', rows:7, cols:7, map:[['S',0,1,0,0,0,0],[0,0,1,0,'C',1,0],[0,0,0,0,0,1,0],[1,1,1,0,0,0,0],[0,'P',0,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,1,0,0,'E']], timer:90 },
      { id:3, title:'Decoys', rows:8, cols:8, map:(()=>{ const m=Array.from({length:8},()=>Array(8).fill(0)); m[0][0]='S'; m[7][7]='E'; m[1][2]='C'; m[2][5]='T'; m[3][3]='P'; [[1,1],[1,3],[2,2],[4,4],[5,2],[6,3]].forEach(([r,c])=>m[r][c]=1); return m })(), timer:150 }
    ];

    let levels = JSON.parse(localStorage.getItem(KEY_LEVELS) || 'null') || DEFAULT_LEVELS;
    let save = JSON.parse(localStorage.getItem(KEY) || 'null') || { current:1, hints:3, completed:[] };

    // ---------------- State ----------------
    let state = { levelIdx: Math.max(0, save.current-1), player:null, map:null, rows:0, cols:0, moves:0, timeLeft:null, timerInterval:null };

    // DOM
    const boardEl = $('#board'); const levelTitle = $('#levelTitle'); const stageInfo = $('#stageInfo');
    const timerEl = $('#timer'); const movesEl = $('#moves'); const hintsEl = $('#hints'); const currentLevelEl = $('#currentLevel'); const completedList = $('#completedList');
    const modal = $('#modal'); const modalContent = $('#modalContent');

    // ---------------- Helpers ----------------
    function saveAll(){ localStorage.setItem(KEY, JSON.stringify(save)); localStorage.setItem(KEY_LEVELS, JSON.stringify(levels)); }

    function formatTime(s){ if(s==null) return '--:--'; const mm = String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${mm}:${ss}` }

    // ---------------- Load Level ----------------
    function loadLevel(idx){ if(idx<0) idx=0; if(idx>=levels.length) idx=levels.length-1; state.levelIdx = idx; const L = levels[idx]; state.rows = L.rows; state.cols = L.cols; state.map = JSON.parse(JSON.stringify(L.map)); state.player = findStart(state.map); state.moves = 0; state.timeLeft = L.timer || null; if(state.timerInterval) clearInterval(state.timerInterval); if(state.timeLeft) startTimer(); renderBoard(); updateUI(); }

    function findStart(m){ for(let r=0;r<m.length;r++) for(let c=0;c<m[0].length;c++) if(m[r][c]==='S') return {r,c}; return {r:0,c:0}; }

    function startTimer(){ timerEl.textContent = formatTime(state.timeLeft); state.timerInterval = setInterval(()=>{ state.timeLeft--; timerEl.textContent = formatTime(state.timeLeft); if(state.timeLeft<=0){ clearInterval(state.timerInterval); onTimeExpired(); } },1000); }

    function updateUI(){ const L = levels[state.levelIdx]; levelTitle.textContent = `${L.id}. ${L.title}`; stageInfo.textContent = `${state.rows} Ã— ${state.cols}`; movesEl.textContent = state.moves; hintsEl.textContent = save.hints; currentLevelEl.textContent = (state.levelIdx+1); completedList.textContent = save.completed.length ? save.completed.join(', ') : 'â€”'; save.current = state.levelIdx+1; saveAll(); }

    // ---------------- Render ----------------
    function renderBoard(){ boardEl.innerHTML=''; boardEl.style.gridTemplateColumns = `repeat(${state.cols}, auto)`; for(let r=0;r<state.rows;r++){ for(let c=0;c<state.cols;c++){ const val = state.map[r][c]; const el = document.createElement('div'); el.className='cell tile'; if(val===1) el.className='cell wall'; else if(val==='S') el.classList.add('start'); else if(val==='E') el.classList.add('exit'); else if(val==='C') el.classList.add('clue'); else if(val==='T') el.classList.add('trap'); else if(val==='P') el.classList.add('puzzle'); if(state.player && state.player.r===r && state.player.c===c){ el.classList.add('player'); el.innerHTML = '<span style="font-size:18px">ðŸŸ¦</span>' } else if(el.classList.contains('clue')) el.textContent='?'; else if(el.classList.contains('puzzle')) el.textContent='âš™'; else if(el.classList.contains('exit')) el.textContent='âŽ‹'; else if(el.classList.contains('start')) el.textContent='â—Ž'; el.dataset.r=r; el.dataset.c=c; el.addEventListener('click', onCellClick); boardEl.appendChild(el); } } }

    // ---------------- Movement & Interaction ----------------
    function movePlayer(dr,dc){ if(!state.player) return; const nr = state.player.r+dr, nc = state.player.c+dc; if(nr<0||nc<0||nr>=state.rows||nc>=state.cols) return; const tile = state.map[nr][nc]; if(tile===1) return; state.player.r=nr; state.player.c=nc; state.moves++; sfx(800,0.05); if(tile==='T'){ onTrap(nr,nc); } else if(tile==='C'){ onClue(nr,nc); } else if(tile==='P'){ onPuzzle(nr,nc); } else if(tile==='E'){ onExit(); } renderBoard(); updateUI(); }

    function onCellClick(e){ const r=+e.currentTarget.dataset.r, c=+e.currentTarget.dataset.c; const dR=r-state.player.r, dC=c-state.player.c; if(Math.abs(dR)+Math.abs(dC)===1){ movePlayer(dR,dC); } else { showModal(`<h3>Tile</h3><p class='muted'>Row ${r+1}, Col ${c+1}</p>`); } }

    function onTrap(r,c){ sfx(160,0.12,0.08); const penalty = 12; state.timeLeft = Math.max(0,(state.timeLeft||0)-penalty); showModal(`<h3>Trap!</h3><p class='muted'>You hit a trap and lost ${penalty} seconds.</p>`); updateUI(); }
    function onClue(r,c){ const isFake = Math.random()<0.25; if(isFake) showModal(`<h3>Clue</h3><p class='muted'>This clue seems suspicious â€” could be a decoy.</p>`); else showModal(`<h3>Clue</h3><p class='muted'>Real clue: sometimes the exit sits at a corner.</p>`); }

    function onPuzzle(r,c){ const q = randomPuzzle(); showModal(`<h3>Puzzle</h3><p class='muted'>${q.q}</p><div style='margin-top:12px'><input id='puzzleAnswer' placeholder='answer...' style='width:60%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)' /></div><div style='display:flex;justify-content:flex-end;margin-top:10px'><button id='tryPuzzle' class='btn primary'>Submit</button></div>`); $('#tryPuzzle').onclick = ()=>{ const val = $('#puzzleAnswer').value.trim().toLowerCase(); if(val===q.a.toLowerCase()){ showModal(`<h3>Correct!</h3><p class='muted'>Puzzle solved â€” nearby walls may be removed.</p>`); revealNearby(r,c); state.map[r][c]=0; renderBoard(); } else { showModal(`<h3>Incorrect</h3><p class='muted'>Try again or use a hint.</p>`); } }; }

    function randomPuzzle(){ const bank=[{q:'2,4,8,16,... next?', a:'32'},{q:"Unscramble 'GRID' then remove 'G' â€” result?", a:'rid'},{q:'Abbrev for Escape The Grid?', a:'etg'}]; return bank[Math.floor(Math.random()*bank.length)]; }

    function revealNearby(r,c){ const deltas=[[1,0],[-1,0],[0,1],[0,-1]]; for(const [dr,dc] of deltas){ const rr=r+dr, cc=c+dc; if(rr>=0&&cc>=0&&rr<state.rows&&cc<state.cols && state.map[rr][cc]===1) state.map[rr][cc]=0; } }

    function onExit(){ sfx(1200,0.06); showModal(`<h3>Level Complete</h3><p class='muted'>You escaped!</p><div style='display:flex;gap:8px;justify-content:flex-end;margin-top:12px'><button id='nextBtn' class='btn primary'>Next Level</button></div>`); $('#nextBtn').onclick = ()=>{ closeModal(); nextLevel(); }; const id = levels[state.levelIdx].id; if(!save.completed.includes(id)) save.completed.push(id); saveAll(); updateUI(); }

    function onTimeExpired(){ showModal(`<h3>Time's up</h3><p class='muted'>Restart the level and try a different path.</p>`); }

    // ---------------- Modal ----------------
    function showModal(html){ modalContent.innerHTML = html; modal.classList.add('open'); }
    function closeModal(){ modal.classList.remove('open'); modalContent.innerHTML=''; }
    $('#closeModal').onclick = () => closeModal(); modal.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });

    // ---------------- Controls ----------------
    document.addEventListener('keydown', e=>{ if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return; const k = e.key.toLowerCase(); if(['arrowup','w'].includes(k)) movePlayer(-1,0); else if(['arrowdown','s'].includes(k)) movePlayer(1,0); else if(['arrowleft','a'].includes(k)) movePlayer(0,-1); else if(['arrowright','d'].includes(k)) movePlayer(0,1); });
    $('#up').onclick = ()=>movePlayer(-1,0); $('#down').onclick = ()=>movePlayer(1,0); $('#left').onclick = ()=>movePlayer(0,-1); $('#right').onclick = ()=>movePlayer(0,1);
    $('#replay').onclick = ()=>loadLevel(state.levelIdx);

    $('#hintBtn').onclick = ()=>{ if(save.hints<=0){ showModal(`<h3>No hints</h3><p class='muted'>You've used all hints.</p>`); return; } save.hints--; saveAll(); hintsEl.textContent = save.hints; revealSafe(); };

    function revealSafe(){ const r=state.player.r, c=state.player.c; const dirs=[[1,0],[-1,0],[0,1],[0,-1]]; for(const [dr,dc] of dirs){ const rr=r+dr, cc=c+dc; if(rr>=0&&cc>=0&&rr<state.rows&&cc<state.cols && state.map[rr][cc]!==1){ const el = boardEl.querySelector(`[data-r='${rr}'][data-c='${cc}']`); if(el){ el.classList.add('fade'); setTimeout(()=>el.classList.remove('fade'),1200); showModal(`<h3>Hint</h3><p class='muted'>Try tile Row ${rr+1}, Col ${cc+1} â€” it's likely safe.</p>`); return; } } } showModal(`<h3>Hint</h3><p class='muted'>No safe adjacent tiles found.</p>`); }

    // ---------------- Level editor ----------------
    function populateEditor(){ $('#levelJson').value = JSON.stringify(levels,null,2); }
    $('#openEditor').onclick = ()=>{ populateEditor(); showModal(`<h3>Level Editor</h3><p class='muted'>Edit the JSON in the panel and click "Load JSON".</p>`); }
    $('#loadJson').onclick = ()=>{ try{ const parsed = JSON.parse($('#levelJson').value); levels = parsed; saveAll(); loadLevel(0); showModal(`<h3>Loaded</h3><p class='muted'>Custom levels loaded successfully.</p>`); }catch(e){ alert('Invalid JSON: '+e.message) } };
    $('#saveJson').onclick = ()=>{ const blob = new Blob([JSON.stringify(levels,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='escape-grid-levels.json'; a.click(); URL.revokeObjectURL(url); };

    // ---------------- Level nav ----------------
    $('#prevLevel').onclick = ()=>{ loadLevel(Math.max(0,state.levelIdx-1)); }
    $('#nextLevel').onclick = ()=>{ nextLevel(); }
    function nextLevel(){ const ni = Math.min(levels.length-1, state.levelIdx+1); loadLevel(ni); }

    // ---------------- Export/Import ----------------
    $('#exportBtn').onclick = ()=>{ const blob = new Blob([JSON.stringify(save,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='escape-grid-save.json'; a.click(); URL.revokeObjectURL(url); }

    $('#restartAll').onclick = ()=>{ if(confirm('Reset progress and levels?')){ localStorage.removeItem(KEY); localStorage.removeItem(KEY_LEVELS); levels = DEFAULT_LEVELS.slice(); save = { current:1, hints:3, completed:[] }; loadLevel(0); updateUI(); } }

    // ---------------- Tutorial & Extras ----------------
    $('#tutorialBtn').onclick = ()=>{ showModal(`<h3>Tutorial</h3><ol class='muted'><li>Move with arrow keys or click adjacent tiles.</li><li>Clue tiles give hints (some are fake).</li><li>Puzzle tiles require answers to unlock shortcuts.</li><li>Traps reduce your timer.</li><li>Use hints from the top-right; progress saves automatically.</li></ol>`); };

    $('#unlockBtn').onclick = ()=>{ unlockGTU(); };

    function unlockGTU(){ if(levels.some(l=>l.id===999)){ showModal(`<h3>Already unlocked</h3><p class='muted'>GTU level exists in your list.</p>`); return; } const lvl={ id:999, title:'GTU Easter', rows:6, cols:6, map:[['S',0,0,'P',0,0],[0,1,0,0,'C',0],[0,0,1,0,0,0],[0,0,0,1,0,0],[0,'C',0,0,1,0],[0,0,0,0,0,'E']], timer:120 }; levels.push(lvl); saveAll(); showModal(`<h3>Unlocked</h3><p class='muted'>GTU Easter level added.</p>`); }

    // ---------------- Init ----------------
    loadLevel(Math.max(0,save.current-1)); populateEditor();
    window.addEventListener('beforeunload', ()=>{ saveAll(); });
  </script>
</body>
</html>
